---
title: "The Route 508 Streetcar and Congestion on Toronto's Shoreline, 2011 - 2020"
subtitle: "Examining Traffic Patterns Before and After Public Transit Improvements"
author: 
  - Maria Mangru
thanks: "Code and data are available at: https://github.com/MariaMangru/Traffic-Congestion-on-Toronto-s-Shoreline."
date: today
date-format: long
abstract: "This study investigates the impact of enhanced public transit infrastucture on car congestion. It specifically focuses on the reintroduction of the Route 508 Lake Shore streetcar between 2014 and 2020. The data, sourced from the City of Toronto's Transportation Services Division, includes detailed traffic volumes for various modes at intersections across the city. The method of analysis includes comparing the negative binomial regression models of daily car traffic before and after transit upgrades. The results highlighted a significant reduction in the relationship between bus traffic and car congestion. Additionally, it was observed that car traffic decreased over time. These findings highlight the usefulness of public transit improvements in reducing urban congestion."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r, echo=FALSE, message=FALSE}
#| include: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
library(here)
library(knitr)
library(stringr)
library(broom)
library(kableExtra)
library(MASS) 
library(car)
```

# Introduction

Traffic congestion represents a significant challenge for urban cities. It is a non-productive activity which negatively affects economic efficiency, environmental sustainability and overall quality of life. To address this challenge, many cities like Toronto have undergone improvements to public transit infrastructure with the aim of reducing car dependency and mitigate traffic congestion. However, it is still highly debatable whether or not such improvements lead to a decrease in car congestion.

This study specifically investigates the 508 Lake Shore Streetcar route in Toronto. It utilizes two datasets provided by the City of Toronto's Transportation Services Division. These datasets capture traffic volumes for various modes at city intersections. To analyze this data, @citeR was used along with several R packages. Through the use of a negative binomial regression, we can assess daily car traffic relative to bus traffic, pedestrian, bicycle flows and a time trend. Models were created to investigate traffic patterns before and after public transit improvements.

The estimand of this study is quantitatively evaluated through the change in the relationship between daily bus traffic and daily car traffic, as well as the evolution of car traffic trends over time. The findings from this study indicates a significant reduction in the relationship between bus traffic and car congestion, following the transit improvements. Additionally, a reversal from an increasing to a decreasing trend in car traffic over time was noted.

This research begins with an in-depth exploration of the dataset and the analytical methods employed, highlighting the use of @citeR for data analysis. It then goes on to explain the results of the regression model, comparing and contrasting traffic patterns prior to and following the installation of transportation upgrades. The discussion interprets these findings within the broader framework of managing urban congestion and the importance of public transit. Through this approach, I hope to illustrate the important role of public transit improvements in combating urban congestion, as well as its significance for promoting sustainable urban mobility and imporving the standard of living in urban areas.

# Data {#sec-data}

## Data Source

This research relies on traffic volume data sets from the City of Toronto's Transportation Services Division. It accessible through the Toronto OpenData portal and is titled "Traffic Volumes at Intersections for All Modes" which is free and accessible for public use. The information collected in the dataset are of two main types:

1.  Automatic Traffic Recorder Counts (ATR): These are segment-level volumes which capture the total number of vehicles, cyclists, or pedestrians moving in a specific direction on a street.

2.  Turning Movement Counts (TMCs): These detail the volume observed at each leg of an intersection, including the turning movement by mode (car, truck, bus, pedestrian, cyclist, other).

The data set covers various intersections across Toronto, providing a detailed view of the city's traffic dynamics. It includes data spanning 2010-2019 and 2020-2024 which was combined into one data set. The data set is segmented by direction of approach, turning movement, and mode, in 15-minute intervals. This level of detail allows for a thorough investigation of traffic patterns, which is especially important for analyzing how changes to public transport affect traffic congestion on the 508 Lake Shore route.

The data set was cleaned and prepared, with yearly data files combined, relevant date periods filtered, and traffic volumes aggregated to get daily totals for every mode of transportation. This preprocessing step made sure the data was suitable for analysis, with a particular emphasis on the time frame prior to and following the 508 Lake Shore route's streetcar upgrades.

## Variables of Interst

In addition to a temporal trend variables, specific variables were chosen for this analysis, with an emphasis on the dynamics of car traffic in relation to bus, pedestrian, anc bicycle traffic volumes:

-   Daily Car Traffic (`daily_cars`): Total volume of car traffic recorded at selected intersections along the 508 Route.
-   Daily Bus Traffic (`daily_bus`), Pedestrian Traffic (`daily_peds`) and Bicycle Traffic (`daily_bike`): Bus, pedestrian and bike traffic volumes used to indicate the presence and frequency of non personal car usage.
-   Time Trend (time_trend): A constructed variable to analyze traffic pattern changes over time.

Using @citeR, the dataset was processed by using tools like `ggplot2` for visualization, `dplyr` for data manipulation, and `lubridate` for date management. These packages made it easier to clean, aggregate, and analyze traffic volumes, which helped to provide a more complex picture of traffic patterns and flow.

```{r summary-stats-table, echo=FALSE, message=FALSE, warning=FALSE}
# Load the cleaned data
cleaned_data <- read_csv(here("data", "analysis_data", "cleaned-data.csv"))

# Generate summary statistics for traffic data
summary_stats <- summarise(cleaned_data,
  Mean_Cars = mean(daily_cars, na.rm = TRUE),
  Median_Cars = median(daily_cars, na.rm = TRUE),
  Mean_Buses = mean(daily_bus, na.rm = TRUE),
  Median_Buses = median(daily_bus, na.rm = TRUE),
  Mean_Pedestrians = mean(daily_peds, na.rm = TRUE),
  Median_Pedestrians = median(daily_peds, na.rm = TRUE),
  Mean_Bicycles = mean(daily_bike, na.rm = TRUE),
  Median_Bicycles = median(daily_bike, na.rm = TRUE)
)

# Create a data frame for the kable function
summary_stats_df <- data.frame(
  Transport_Mode = c("Daily Car Traffic", "Daily Bus Traffic", "Daily Pedestrian Traffic", "Daily Bicycle Traffic"),
  Mean = c(summary_stats$Mean_Cars, summary_stats$Mean_Buses, summary_stats$Mean_Pedestrians, summary_stats$Mean_Bicycles),
  Median = c(summary_stats$Median_Cars, summary_stats$Median_Buses, summary_stats$Median_Pedestrians, summary_stats$Median_Bicycles)
)

# Display summary statistics
kable(summary_stats_df, format = "html", 
      col.names = c("Transport Mode", "Mean", "Median"),
      caption = "Summary statistics table for daily traffic volume",
      table.attr = 'style="width:100%;"') 
```

The summary table above provides a quantitative comparison across transportation modes by condensing the traffic data for each mode into average and median statistics. The data reveals that car traffic surpasses other modes in volume, with the mean and median values for daily car traffic being the highest.

```{r line-graph-cars, fig.cap="Daily Car Traffic Over Time. This graph displays the trend in number of cars within the area of interest between December 2011 to December 2014 and November 2018 to February 2020.",fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

# Visualizing daily car traffic over time
line_graph_car <- cleaned_data %>%
  ggplot(aes(x = count_date, y = daily_cars)) +
  geom_smooth(se = FALSE) +  
  labs(title = "Daily Cars Traffic Over Time",
       x = "Date",
       y = "Total Cars Traffic") +
  theme_minimal()

# Display car traffic plot
line_graph_car

```

The daily variation in car traffic from 2011 to 2020 is shown in Figure 1. The traffic volume is depicted on a smooth line graph that first increases and peaks about 2016, after which it sharply declines. The fall that follows may point to the benefits of the Route 508 Lake Shore streetcar improvements on easing traffic congestion. The peak denotes a period of increased traffic.

```{r line-graph-bus, fig.cap="Daily Bus Traffic Over Time. This graph displays the trend in number of buses within the area of interest between December 2011 to December 2014 and November 2018 to February 2020.", fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

# Visualizing daily bus traffic over time
line_graph_buses <- cleaned_data %>%
  ggplot(aes(x = count_date, y = daily_bus)) +
  geom_smooth(se = FALSE) +
  labs(title = "Daily Bus Traffic Over Time",
       x = "Date",
       y = "Total Bus Traffic") +
  theme_minimal()

# Display bus traffic plot
line_graph_buses

```

Figure 2 depicts the daily patterns in bus traffic, which follow a similar pattern to that of car traffic. It is a smooth line graph that rises to a high around in 2016, then declines. This pattern might be an indication of how bus utilization has changed, which could be related to the streetcar route's service modifications and other improvements to public transportation.

```{r line-graph-pedestrian, fig.cap="Daily Pedestrian Traffic Over Time. This graph displays the trend in number of pedestrian within the area of interest between December 2011 to December 2014 and November 2018 to February 2020.", fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

# Visualizing daily pedestrian traffic over time
line_graph_pedestrians <- cleaned_data %>%
  ggplot(aes(x = count_date, y = daily_peds)) +
  geom_smooth(se = FALSE) +
  labs(title = "Daily Pedestrian Traffic Over Time",
       x = "Date",
       y = "Total Pedestrian Traffic") +
  theme_minimal()

# Display pedestrian traffic plot
line_graph_pedestrians

```

Variations in pedestrian traffic over is shown in Figure 3's line graph. The middle of the time period has a noteworthy decrease, which is followed by a rise and another decline. This could be attributed to a number of things, such as changes in walkability, urban development, and perhaps the availability of better public transportation alternatives that encourage walking as a mode of transportation.

```{r line-graph-bike, fig.cap="Daily Bike Traffic Over Time. This graph displays the trend in number of bikes within the area of interest between December 2011 to December 2014 and November 2018 to February 2020.", fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

# Visualizing daily bike traffic over time
line_graph_cyclists <- cleaned_data %>%
  ggplot(aes(x = count_date, y = daily_bike)) +
  geom_smooth(se = FALSE) +
  labs(title = "Daily Cyclist Traffic Over Time",
       x = "Date",
       y = "Total Cyclist Traffic") +
  theme_minimal()

# Display cyclist traffic plot
line_graph_cyclists

```

The pattern of bicycle traffic over time is depicted in Figure 4, where a notable rise and fall are shown on the line graph, indicating huge variations. The variations may be attributed to changing public opinions on riding, the implementation of bike infrastructure, or seasonal variations in weather patterns, which may be exacerbated by changes made to the transit system.

```{r line-graph-time-trend, fig.cap="Daily Car Traffic Over Time. This graph displays the general trend in number of cars from the beginning of data collection period.", fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

# Visualizing car traffic with respect to the time trend
time_trend_graph_car <- cleaned_data %>%
  ggplot(aes(x = time_trend, y = daily_cars)) +
  geom_point(aes(color = daily_cars), alpha = 0.5) + 
  geom_smooth(method = "lm", se = FALSE, color = "blue") +  
  scale_color_gradient(low = "blue", high = "red") +
  labs(title = "Car Traffic Volume Over Time Trend",
       x = "Days Since Start",
       y = "Daily Car Traffic",
       color = "Daily Traffic") +
  theme_minimal()

# Display car traffic plot with time trend
time_trend_graph_car

```

The scatter plot illustrates the fluctuating daily car counts over time, with a trend line suggesting an initial increase in traffic followed by a decline.

# Model

This study uses negative binomial regression to address the problem of overdispersion, which occurs when observed variance is greater than the mean and is frequently seen in count data. The dependent variable in the model is the daily count of cars, which is assumed to be impacted by temporal variations and the counts of alternative transportation modes (such as buses, bicycles, and pedestrians).

As such, we estimate the following model:

```{=tex}
\begin{align*} 
\log(\text{Count\_Cars}) &= \beta_0 + \beta_1 \times \text{Bus} + \beta_2 \times \text{Pedestrians} + \beta_3 \times \text{Bike} + \text{time\_trend} \\
\text{where} & \\
\log(\text{Count\_Cars}) & \text{ is the natural logarithm of the count of cars,} \\
\beta_0 & \text{ is the intercept of the model,} \\
\beta_1, \beta_2, \beta_3 & \text{ are the coefficients for the counts of buses, pedestrians, and bicycles,} \\
\text{time\_trend} & \text{ is the variable capturing the longitudinal changes.}
\end{align*}
```



## Model justification

There are two reasons for using negative binomial regression. First, since events tend to cluster together in both place and time, traffic count data usually show overdispersion. For such data, the negative binomial model makes sense since it allows the variance to surpass the mean. Second, given that traffic counts frequently deviate from a normal distribution, this model can account for their skewed nature.

The analysis is divided into two temporal models in order to evaluate the effects of the Route 508 Lake Shore streetcar service upgrades: `model_before`, which is the model before the improvements, and `model_after`, which is the model after the improvements. This method clarifies the relationship that existed before and after the policy intervention between the independent and dependent variables.

Together with a temporal trend, the `model_before` captures the baseline relationship between automobile traffic and other modes of transportation. As an illustration of possible changes in traffic patterns brought about by the improved streetcar service, the `model_after`, on the other hand, depicts the altered dynamics following the enhancement. By use of comparative analysis, these models demonstrate the effectiveness of the Route 508 enhancements in mitigating car congestion.


# Results

```{r mdoel summaries, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

# Read and prepare data
analysis_data <- read.csv(here("data", "analysis_data", "cleaned-data.csv"))
analysis_data$count_date <- as.Date(analysis_data$count_date)

# Scaling predictor variables for analysis
analysis_data <- analysis_data %>%
  mutate(
    daily_bus = scale(daily_bus, center = TRUE, scale = TRUE),
    daily_peds = scale(daily_peds, center = TRUE, scale = TRUE),
    daily_bike = scale(daily_bike, center = TRUE, scale = TRUE)
  )

# Splitting the dataset into before and after a specific date for comparison
start_before <- as.Date("2011-12-31")
end_before <- as.Date("2014-12-31")
start_after <- as.Date("2018-11-01")
end_after <- as.Date("2020-02-29")

before_improvement <- subset(analysis_data, count_date >= start_before & count_date <= end_before)
after_improvement <- subset(analysis_data, count_date >= start_after & count_date <= end_after)

### Model data ####

analysis_data <- analysis_data %>%
  mutate(time_trend = as.numeric(count_date - min(count_date, na.rm = TRUE)))

before_improvement <- subset(analysis_data, count_date >= start_before & count_date <= end_before)
after_improvement <- subset(analysis_data, count_date >= start_after & count_date <= end_after)

# Building negative binomial regression models for before and after improvement
model_before <- glm.nb(daily_cars ~ daily_bus + daily_peds + daily_bike + time_trend, data = before_improvement)
model_after <- glm.nb(daily_cars ~ daily_bus + daily_peds + daily_bike + time_trend, data = after_improvement)

# Tidying the model summaries 
tidy_model_before <- tidy(model_before)
tidy_model_after <- tidy(model_after)

# Model before improvement
kable(tidy_model_before, caption = "Negative Binomial Regression Model - Before Improvement") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Model after improvement
kable(tidy_model_after, caption = "Negative Binomial Regression Model - After Improvement") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```


# Discussion

## First discussion point {#sec-first-point}

## Second discussion point

## Third discussion point

## Weaknesses and next steps


\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

## Diagnostics

\newpage

# References
